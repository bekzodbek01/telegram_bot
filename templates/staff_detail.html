{% extends "base.html" %}
{% block title %}{{ name }}{% endblock %}
{% block content %}
<div class="card">
  <h2>{{ name }} â€” {{ position }}</h2>
  <p style="color:#475569; margin-top:-6px;">
    ID: {{ staff_id }} Â· Hudud: {{ region }}
  </p>

  <!-- Tugmalar -->
  <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:12px;">
    <a class="btn" href="/admin/staff/{{ staff_id }}/qr">â¬‡ QR</a>
    <a class="btn secondary" href="/admin/staff/{{ staff_id }}/excel">â¬‡ Excel</a>
    <a class="btn gray" target="_blank"
       href="https://t.me/{{ bot_username }}?start=staff_{{ staff_id }}">
       ğŸ”— Botga havola
    </a>
  </div>

  <!-- Statistikalar -->
  <div style="display:flex; gap:16px; margin-top:16px; flex-wrap:wrap;">
    <span class="badge ok">ğŸ‘ {{ stats.likes }}</span>
    <span class="badge warn">ğŸ‘ {{ stats.dislikes }}</span>
    <span class="badge" style="background:#e2e8f0;color:#0f172a;">ğŸ˜ {{ stats.neutrals }}</span>
    <span class="badge" style="background:#dbeafe;color:#1e40af;">Jami: {{ stats.total }}</span>
  </div>

  <!-- â­ Oyni tanlab Oâ€˜CHIRISH -->
  <form method="post" action="/admin/staff/{{ staff_id }}/reset/month"
        style="margin-top:25px; display:flex; gap:10px; flex-wrap:wrap;">

    <!-- Oy (nomlar bilan) -->
    <select name="month" required
      style="padding:8px 12px; border-radius:8px; border:1px solid #ccc; font-size:15px;">
      <option value="">Oy</option>
      <option value="1">Yanvar</option>
      <option value="2">Fevral</option>
      <option value="3">Mart</option>
      <option value="4">Aprel</option>
      <option value="5">May</option>
      <option value="6">Iyun</option>
      <option value="7">Iyul</option>
      <option value="8">Avgust</option>
      <option value="9">Sentabr</option>
      <option value="10">Oktabr</option>
      <option value="11">Noyabr</option>
      <option value="12">Dekabr</option>
    </select>

    <!-- Yil -->
    <select name="year" required
      style="padding:8px 12px; border-radius:8px; border:1px solid #ccc; font-size:15px;">
      <option value="">Yil</option>
      <option value="{{ now_year }}">{{ now_year }}</option>
      <option value="{{ now_year - 1 }}">{{ now_year - 1 }}</option>
    </select>

    <button style="background:#dc2626;color:white;
        padding:10px 20px;border:none;border-radius:10px;cursor:pointer;">
      ğŸ—‘ Tanlangan oy baholarini oâ€˜chirish
    </button>
  </form>

  <!-- â­ OY/YIL boâ€˜yicha EXCEL chiqarish -->
  <form method="get" action="/admin/staff/{{ staff_id }}/excel"
        style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">

    <input type="hidden" name="month" id="excel_month">
    <input type="hidden" name="year" id="excel_year">

    <button type="submit"
      onclick="
        document.getElementById('excel_month').value =
            document.querySelector('select[name=month]').value;
        document.getElementById('excel_year').value =
            document.querySelector('select[name=year]').value;
      "
      style="background:#2563eb; color:white;
            padding:10px 20px; border:none;
            border-radius:10px; cursor:pointer;">
        ğŸ“˜ Tanlangan oy â†’ Excel chiqarish
    </button>
  </form>

  <!-- â­ Faqat shu xodimning barcha bahosini oâ€˜chirish -->
  <form method="post" action="/admin/staff/{{ staff_id }}/reset/all"
        style="margin-top:12px;">
    <button style="background:#7f1d1d;color:white;padding:10px 20px;
           border:none;border-radius:10px;cursor:pointer;">
      ğŸ—‘ Barcha ovozlarini oâ€˜chirish
    </button>
  </form>
</div>

<!-- CHART -->
<div class="card chart-card" style="margin-top:16px; text-align:center;">
  <h2>Ovozlar taqsimoti</h2>

  <div style="max-width: 260px; margin: 0 auto;">
    <canvas id="pieChart" width="260" height="260"></canvas>
  </div>
</div>

<script>
  const ctx2 = document.getElementById('pieChart');
  new Chart(ctx2, {
    type: 'pie',
    data: {
      labels: ['ğŸ‘ Yaxshi', 'ğŸ‘ Yomon', 'ğŸ˜ Neytral'],
      datasets: [{
        data: [{{ stats.likes }}, {{ stats.dislikes }}, {{ stats.neutrals }}],
        backgroundColor: ['#22c55e', '#ef4444', '#eab308']
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom' } }
    }
  });
</script>

{% endblock %}
