{% extends "base.html" %}
{% block title %}{{ name }}{% endblock %}
{% block content %}
<div class="card">
  <h2>{{ name }} â€” {{ position }}</h2>
  <p style="color:#475569; margin-top:-6px;">
    ID: {{ staff_id }} Â· Hudud: {{ region }}
  </p>

  <!-- Tugmalar -->
  <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:12px;">
      <a class="btn" href="/admin/staff/{{ staff_id }}/qr-view">ğŸ‘ QR Korish</a>
    <a class="btn secondary" href="/admin/staff/{{ staff_id }}/excel">â¬‡ Excel</a>
    <a class="btn gray" target="_blank"
        href="https://t.me/{{ bot_username }}?start=staff_{{ staff_id }}">
       ğŸ”— Botga havola
    </a>
  </div>

  <!-- Statistikalar -->
  <div style="display:flex; gap:16px; margin-top:16px; flex-wrap:wrap;">
    <span class="badge ok">ğŸ‘ {{ stats.likes }}</span>
    <span class="badge warn">ğŸ‘ {{ stats.dislikes }}</span>
    <span class="badge" style="background:#e2e8f0;color:#0f172a;">ğŸ˜ {{ stats.neutrals }}</span>
    <span class="badge" style="background:#dbeafe;color:#1e40af;">Jami: {{ stats.total }}</span>
  </div>


  <!-- â­ OY/YIL TANLASH BLOKI -->
  <div style="margin-top:25px;">

      <!-- Oyni tanlash -->
      <label><b>Oy</b></label>
      <select id="month_select"
          style="padding:8px 12px;border-radius:8px;border:1px solid #ccc;font-size:15px;">
          {% for m in [
            (1,"Yanvar"),(2,"Fevral"),(3,"Mart"),(4,"Aprel"),(5,"May"),(6,"Iyun"),
            (7,"Iyul"),(8,"Avgust"),(9,"Sentabr"),(10,"Oktabr"),(11,"Noyabr"),(12,"Dekabr")
          ] %}
          <option value="{{ m[0] }}"
                {% if m[0] == now_month %}selected{% endif %}>
              {{ m[1] }}
          </option>
          {% endfor %}
      </select>

      <!-- Yilni tanlash -->
      <label class="mt-3"><b>Yil</b></label>
      <select id="year_select"
          style="padding:8px 12px;border-radius:8px;border:1px solid #ccc;font-size:15px;">
          {% for y in range(now_year-1, now_year+2) %}
          <option value="{{ y }}"
                {% if y == now_year %}selected{% endif %}>
              {{ y }}
          </option>
          {% endfor %}
      </select>

      <!-- â­ Tanlangan oy boâ€˜yicha oâ€˜chirish -->
      <form method="post"
            action="/admin/staff/{{ staff_id }}/reset/month"
            style="margin-top:12px;">
          <input type="hidden" name="month" id="del_month">
          <input type="hidden" name="year" id="del_year">

          <button class="btn danger w-100"
              onclick="
                    document.getElementById('del_month').value =
                        document.getElementById('month_select').value;
                    document.getElementById('del_year').value =
                        document.getElementById('year_select').value;
              ">
              ğŸ—‘ Tanlangan oy baholarini oâ€˜chirish
          </button>
      </form>

      <!-- â­ Tanlangan oy boâ€˜yicha Excel chiqarish -->
      <form method="get" id="excel_form"
            style="margin-top:10px;">
          <button type="button"
              onclick="
                let m = document.getElementById('month_select').value;
                let y = document.getElementById('year_select').value;
                window.location = '/admin/export/excel/month?month='+m+'&year='+y;
              "
              class="btn primary w-100">
              ğŸ“˜ Tanlangan oy â†’ Excel chiqarish
          </button>
      </form>

      <!-- â­ Barcha ovozlarni oâ€˜chirish -->
      <form method="post"
            action="/admin/staff/{{ staff_id }}/reset/all"
            style="margin-top:12px;">
          <button class="btn dark w-100">
              ğŸ—‘ Barcha ovozlarini oâ€˜chirish
          </button>
      </form>

  </div>
</div>

<!-- CHART -->
<div class="card chart-card" style="margin-top:16px; text-align:center;">
  <h2>Ovozlar taqsimoti</h2>

  <div style="max-width: 260px; margin: 0 auto;">
    <canvas id="pieChart" width="260" height="260"></canvas>
  </div>
</div>

<script>
  const ctx2 = document.getElementById('pieChart');
  new Chart(ctx2, {
    type: 'pie',
    data: {
      labels: ['ğŸ‘ Yaxshi', 'ğŸ‘ Yomon', 'ğŸ˜ Neytral'],
      datasets: [{
        data: [{{ stats.likes }}, {{ stats.dislikes }}, {{ stats.neutrals }}],
        backgroundColor: ['#22c55e', '#ef4444', '#eab308']
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'bottom' } }
    }
  });
</script>

{% endblock %}
